// ng-cordova-oauth - v0.1.4 (2015-10-29)
// http://www.nraboy.com
angular.module("oauth.providers",["oauth.utils"]).factory("$cordovaOauth",["$q","$http","$cordovaOauthUtility",function(a,b,c){function d(a,b,d){if(!window.cordova)throw"Cannot authenticate via a web browser";var e=cordova.require("cordova/plugin_list").metadata;if(c.isInAppBrowserInstalled(e)!==!0)throw"Could not find InAppBrowser plugin";b.addEventListener("exit",function(b){a.reject("The sign in flow was canceled")}),d()}return{azureAD:function(c,e,f){var g=a.defer(),h=window.open("https://login.microsoftonline.com/"+e+"/oauth2/authorize?response_type=code&client_id="+c+"&redirect_uri=http://localhost/callback","_blank","location=no,clearsessioncache=yes,clearcache=yes");try{d(g,h,function(){h.addEventListener("loadstart",function(a){if(0===a.url.indexOf("http://localhost/callback")){var d=a.url.split("code=")[1];console.log(d),b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b({method:"post",url:"https://login.microsoftonline.com/"+e+"/oauth2/token",data:"client_id="+c+"&code="+d+"&redirect_uri=http://localhost/callback&grant_type=authorization_code&resource="+f}).success(function(a){g.resolve(a)}).error(function(a,b){g.reject("Problem authenticating")})["finally"](function(){setTimeout(function(){h.close()},10)})}})})}catch(i){g.reject(i)}return g.promise},adfs:function(c,e,f){var g=a.defer(),h=window.open(e+"/adfs/oauth2/authorize?response_type=code&client_id="+c+"&redirect_uri=http://localhost/callback&resource="+f,"_blank","location=no");try{d(g,h,function(){h.addEventListener("loadstart",function(a){if(0===a.url.indexOf("http://localhost/callback")){var d=a.url.split("code=")[1];b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b({method:"post",url:e+"/adfs/oauth2/token",data:"client_id="+c+"&code="+d+"&redirect_uri=http://localhost/callback&grant_type=authorization_code"}).success(function(a){g.resolve(a)}).error(function(a,b){g.reject("Problem authenticating")})["finally"](function(){setTimeout(function(){h.close()},10)})}})})}catch(i){g.reject(i)}return g.promise},dropbox:function(b,c){var e=a.defer(),f="http://localhost/callback";void 0!==c&&c.hasOwnProperty("redirect_uri")&&(f=c.redirect_uri);var g=window.open("https://www.dropbox.com/1/oauth2/authorize?client_id="+b+"&redirect_uri="+f+"&response_type=token","_blank","location=no,clearsessioncache=yes,clearcache=yes");try{d(e,g,function(){g.addEventListener("loadstart",function(a){if(0===a.url.indexOf(f)){g.removeEventListener("exit",function(a){}),g.close();for(var b=a.url.split("#")[1],c=b.split("&"),d=[],h=0;h<c.length;h++)d[c[h].split("=")[0]]=c[h].split("=")[1];void 0!==d.access_token&&null!==d.access_token?e.resolve({access_token:d.access_token,token_type:d.token_type,uid:d.uid}):e.reject("Problem authenticating")}})})}catch(h){e.reject(h)}return e.promise},digitalOcean:function(c,e,f){var g=a.defer(),h="http://localhost/callback";void 0!==f&&f.hasOwnProperty("redirect_uri")&&(h=f.redirect_uri);var i=window.open("https://cloud.digitalocean.com/v1/oauth/authorize?client_id="+c+"&redirect_uri="+h+"&response_type=code&scope=read%20write","_blank","location=no,clearsessioncache=yes,clearcache=yes");try{d(g,i,function(){i.addEventListener("loadstart",function(a){if(0===a.url.indexOf(h)){var d=a.url.split("code=")[1];b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b({method:"post",url:"https://cloud.digitalocean.com/v1/oauth/token",data:"client_id="+c+"&client_secret="+e+"&redirect_uri="+h+"&grant_type=authorization_code&code="+d}).success(function(a){g.resolve(a)}).error(function(a,b){g.reject("Problem authenticating")})["finally"](function(){setTimeout(function(){i.close()},10)})}})})}catch(j){g.reject(j)}return g.promise},google:function(b,c,e){var f=a.defer(),g="http://localhost/callback";void 0!==e&&e.hasOwnProperty("redirect_uri")&&(g=e.redirect_uri);var h=window.open("https://accounts.google.com/o/oauth2/auth?client_id="+b+"&redirect_uri="+g+"&scope="+c.join(" ")+"&approval_prompt=force&response_type=token","_blank","location=no,clearsessioncache=yes,clearcache=yes");try{d(f,h,function(){h.addEventListener("loadstart",function(a){if(0===a.url.indexOf(g)){h.removeEventListener("exit",function(a){}),h.close();for(var b=a.url.split("#")[1],c=b.split("&"),d=[],e=0;e<c.length;e++)d[c[e].split("=")[0]]=c[e].split("=")[1];void 0!==d.access_token&&null!==d.access_token?f.resolve({access_token:d.access_token,token_type:d.token_type,expires_in:d.expires_in}):f.reject("Problem authenticating")}})})}catch(i){f.reject(i)}return f.promise},github:function(c,e,f,g){var h=a.defer(),i="http://localhost/callback";void 0!==g&&g.hasOwnProperty("redirect_uri")&&(i=g.redirect_uri);var j=window.open("https://github.com/login/oauth/authorize?client_id="+c+"&redirect_uri="+i+"&scope="+f.join(","),"_blank","location=no,clearsessioncache=yes,clearcache=yes");try{d(h,j,function(){j.addEventListener("loadstart",function(a){0===a.url.indexOf(i)&&(requestToken=a.url.split("code=")[1],b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b.defaults.headers.post.accept="application/json",b({method:"post",url:"https://github.com/login/oauth/access_token",data:"client_id="+c+"&client_secret="+e+"&redirect_uri="+i+"&code="+requestToken}).success(function(a){h.resolve(a)}).error(function(a,b){h.reject("Problem authenticating")})["finally"](function(){setTimeout(function(){j.close()},10)}))})})}catch(k){}return h.promise},facebook:function(b,c,e){var f=a.defer(),g="http://localhost/callback";void 0!==e&&e.hasOwnProperty("redirect_uri")&&(g=e.redirect_uri);var h="https://www.facebook.com/v2.0/dialog/oauth?client_id="+b+"&redirect_uri="+g+"&response_type=token&scope="+c.join(",");void 0!==e&&e.hasOwnProperty("auth_type")&&(h+="&auth_type="+e.auth_type);var i=window.open(h,"_blank","location=no,clearsessioncache=yes,clearcache=yes");try{d(f,i,function(){i.addEventListener("loadstart",function(a){if(0===a.url.indexOf(g)){i.removeEventListener("exit",function(a){}),i.close();for(var b=a.url.split("#")[1],c=b.split("&"),d=[],e=0;e<c.length;e++)d[c[e].split("=")[0]]=c[e].split("=")[1];void 0!==d.access_token&&null!==d.access_token?f.resolve({access_token:d.access_token,expires_in:d.expires_in}):0!==a.url.indexOf("error_code=100")?f.reject("Facebook returned error_code=100: Invalid permissions"):f.reject("Problem authenticating")}})})}catch(j){f.reject(j)}return f.promise},linkedin:function(c,e,f,g,h){var i=a.defer(),j="http://localhost/callback";void 0!==h&&h.hasOwnProperty("redirect_uri")&&(j=h.redirect_uri);var k=window.open("https://www.linkedin.com/uas/oauth2/authorization?client_id="+c+"&redirect_uri="+j+"&scope="+f.join(" ")+"&response_type=code&state="+g,"_blank","location=no,clearsessioncache=yes,clearcache=yes");try{d(i,k,function(){k.addEventListener("loadstart",function(a){0===a.url.indexOf(j)&&(requestToken=a.url.split("code=")[1].split("&")[0],b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b({method:"post",url:"https://www.linkedin.com/uas/oauth2/accessToken",data:"client_id="+c+"&client_secret="+e+"&redirect_uri="+j+"&grant_type=authorization_code&code="+requestToken}).success(function(a){i.resolve(a)}).error(function(a,b){i.reject("Problem authenticating")})["finally"](function(){setTimeout(function(){k.close()},10)}))})})}catch(l){i.reject(l)}return i.promise},instagram:function(b,e,f){var g=a.defer(),h={code:"?",token:"#"},i="http://localhost/callback",j="token";void 0!==f&&(f.hasOwnProperty("redirect_uri")&&(i=f.redirect_uri),f.hasOwnProperty("response_type")&&(j=f.response_type));var k="";e&&e.length>0&&(k="&scope"+e.join("+"));var l=window.open("https://api.instagram.com/oauth/authorize/?client_id="+b+"&redirect_uri="+i+k+"&response_type="+j,"_blank","location=no,clearsessioncache=yes,clearcache=yes");try{d(g,l,function(){l.addEventListener("loadstart",function(a){if(0===a.url.indexOf(i)){l.removeEventListener("exit",function(a){}),l.close();var b=a.url.split(h[j])[1],d=c.parseResponseParameters(b);void 0!==d.access_token&&null!==d.access_token?g.resolve({access_token:d.access_token}):void 0!==d.code&&null!==d.code?g.resolve({code:d.code}):g.reject("Problem authenticating")}})})}catch(m){g.reject(m)}return g.promise},box:function(c,e,f,g){var h=a.defer(),i="http://localhost/callback";void 0!==g&&g.hasOwnProperty("redirect_uri")&&(i=g.redirect_uri);var j=window.open("https://app.box.com/api/oauth2/authorize/?client_id="+c+"&redirect_uri="+i+"&state="+f+"&response_type=code","_blank","location=no,clearsessioncache=yes,clearcache=yes");try{d(h,j,function(){j.addEventListener("loadstart",function(a){0===a.url.indexOf(i)&&(requestToken=a.url.split("code=")[1],b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b({method:"post",url:"https://app.box.com/api/oauth2/token",data:"client_id="+c+"&client_secret="+e+"&redirect_uri="+i+"&grant_type=authorization_code&code="+requestToken}).success(function(a){h.resolve(a)}).error(function(a,b){h.reject("Problem authenticating")})["finally"](function(){setTimeout(function(){j.close()},10)}))})})}catch(k){h.reject(k)}return h.promise},reddit:function(c,e,f,g,h){var i=a.defer(),j="http://localhost/callback";void 0!==h&&h.hasOwnProperty("redirect_uri")&&(j=h.redirect_uri);var k=window.open("https://ssl.reddit.com/api/v1/authorize"+(g?".compact":"")+"?client_id="+c+"&redirect_uri="+j+"&duration=permanent&state=ngcordovaoauth&scope="+f.join(",")+"&response_type=code","_blank","location=no,clearsessioncache=yes,clearcache=yes");try{d(i,k,function(){k.addEventListener("loadstart",function(a){0===a.url.indexOf(j)&&(requestToken=a.url.split("code=")[1],b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b.defaults.headers.post.Authorization="Basic "+btoa(c+":"+e),b({method:"post",url:"https://ssl.reddit.com/api/v1/access_token",data:"redirect_uri="+j+"&grant_type=authorization_code&code="+requestToken}).success(function(a){i.resolve(a)}).error(function(a,b){i.reject("Problem authenticating")})["finally"](function(){setTimeout(function(){k.close()},10)}))})})}catch(l){i.reject(l)}return i.promise},slack:function(c,e,f,g){var h=a.defer(),i="http://localhost/callback";void 0!==g&&g.hasOwnProperty("redirect_uri")&&(i=g.redirect_uri);var j=window.open("https://slack.com/oauth/authorize?client_id="+c+"&redirect_uri="+i+"&state=ngcordovaoauth&scope="+f.join(","),"_blank","location=no,clearsessioncache=yes,clearcache=yes");try{d(h,j,function(){j.addEventListener("loadstart",function(a){0===a.url.indexOf(i)&&(requestToken=a.url.split("code=")[1],console.log("Request token is "+requestToken),b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b({method:"post",url:"https://slack.com/api/oauth.access",data:"client_id="+c+"&client_secret="+e+"&redirect_uri="+i+"&grant_type=authorization_code&code="+requestToken}).success(function(a){h.resolve(a)}).error(function(a,b){h.reject("Problem authenticating")})["finally"](function(){setTimeout(function(){j.close()},10)}))}),j.addEventListener("exit",function(a){h.reject("The sign in flow was canceled")})})}catch(k){h.reject(k)}return h.promise},twitter:function(e,f,g){var h=a.defer();try{d(h,function(){var a="http://localhost/callback";if(void 0!==g&&g.hasOwnProperty("redirect_uri")&&(a=g.redirect_uri),"undefined"!=typeof jsSHA){var d={oauth_consumer_key:e,oauth_nonce:c.createNonce(10),oauth_signature_method:"HMAC-SHA1",oauth_timestamp:Math.round((new Date).getTime()/1e3),oauth_version:"1.0"},i=c.createSignature("POST","https://api.twitter.com/oauth/request_token",d,{oauth_callback:a},f);b({method:"post",url:"https://api.twitter.com/oauth/request_token",headers:{Authorization:i.authorization_header,"Content-Type":"application/x-www-form-urlencoded"},data:"oauth_callback="+encodeURIComponent(a)}).success(function(e){for(var g=e.split("&"),i={},j=0;j<g.length;j++)i[g[j].split("=")[0]]=g[j].split("=")[1];i.hasOwnProperty("oauth_token")===!1&&h.reject("Oauth request token was not received");var k=window.open("https://api.twitter.com/oauth/authenticate?oauth_token="+i.oauth_token,"_blank","location=no,clearsessioncache=yes,clearcache=yes");k.addEventListener("loadstart",function(e){if(0===e.url.indexOf(a)){for(var g=e.url.split("?")[1],i=g.split("&"),j={},l=0;l<i.length;l++)j[i[l].split("=")[0]]=i[l].split("=")[1];j.hasOwnProperty("oauth_verifier")===!1&&h.reject("Browser authentication failed to complete.  No oauth_verifier was returned"),delete d.oauth_signature,d.oauth_token=j.oauth_token;var m=c.createSignature("POST","https://api.twitter.com/oauth/access_token",d,{oauth_verifier:j.oauth_verifier},f);b({method:"post",url:"https://api.twitter.com/oauth/access_token",headers:{Authorization:m.authorization_header},params:{oauth_verifier:j.oauth_verifier}}).success(function(a){for(var b=a.split("&"),c={},d=0;d<b.length;d++)c[b[d].split("=")[0]]=b[d].split("=")[1];c.hasOwnProperty("oauth_token_secret")===!1&&h.reject("Oauth access token was not received"),h.resolve(c)}).error(function(a){h.reject(a)})["finally"](function(){setTimeout(function(){k.close()},10)})}})}).error(function(a){h.reject(a)})}else h.reject("Missing jsSHA JavaScript library")})}catch(i){h.reject(i)}return h.promise},meetup:function(b,c){var e=a.defer();try{d(e,function(){var a="http://localhost/callback";void 0!==c&&c.hasOwnProperty("redirect_uri")&&(a=c.redirect_uri);var d=window.open("https://secure.meetup.com/oauth2/authorize/?client_id="+b+"&redirect_uri="+a+"&response_type=token","_blank","location=no,clearsessioncache=yes,clearcache=yes");d.addEventListener("loadstart",function(b){if(0===b.url.indexOf(a)){d.removeEventListener("exit",function(a){}),d.close();for(var c=b.url.split("#")[1],f=c.split("&"),g={},h=0;h<f.length;h++)g[f[h].split("=")[0]]=f[h].split("=")[1];void 0!==g.access_token&&null!==g.access_token?e.resolve(g):e.reject("Problem authenticating")}})})}catch(f){e.reject(f)}return e.promise},salesforce:function(b,c){var e=a.defer();try{d(e,function(){var a="http://localhost/callback",d=function(a,b,c){return a+"services/oauth2/authorize?display=touch&response_type=token&client_id="+escape(b)+"&redirect_uri="+escape(c)},f=function(a,b){return a.substr(0,b.length)===b},g=window.open(d(b,c,a),"_blank","location=no,clearsessioncache=yes,clearcache=yes");g.addEventListener("loadstart",function(b){if(f(b.url,a)){var c={},d=b.url.split("#")[1];if(d){var h=d.split("&");for(var i in h){var j=h[i].split("=");c[j[0]]=unescape(j[1])}}"undefined"==typeof c||"undefined"==typeof c.access_token?e.reject("Problem authenticating"):e.resolve(c),setTimeout(function(){g.close()},10)}})})}catch(f){e.reject(f)}return e.promise},strava:function(c,e,f,g){var h=a.defer();try{d(h,function(){var a="http://localhost/callback";void 0!==g&&g.hasOwnProperty("redirect_uri")&&(a=g.redirect_uri);var d=window.open("https://www.strava.com/oauth/authorize?client_id="+c+"&redirect_uri="+a+"&scope="+f.join(",")+"&response_type=code&approval_prompt=force","_blank","location=no,clearsessioncache=yes,clearcache=yes");d.addEventListener("loadstart",function(f){0===f.url.indexOf(a)&&(requestToken=f.url.split("code=")[1],b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b({method:"post",url:"https://www.strava.com/oauth/token",data:"client_id="+c+"&client_secret="+e+"&code="+requestToken}).success(function(a){h.resolve(a)}).error(function(a,b){h.reject("Problem authenticating")})["finally"](function(){setTimeout(function(){d.close()},10)}))})})}catch(i){h.reject(i)}return h.promise},withings:function(e,f){var g=a.defer();try{d(g,function(){if("undefined"!=typeof jsSHA){var a=c.generateOauthParametersInstance(e);a.oauth_callback="http://localhost/callback";var d="https://oauth.withings.com/account/request_token",h=c.createSignature("GET",d,{},a,f);a.oauth_signature=h.signature;var i=c.generateUrlParameters(a);b({method:"get",url:d+"?"+i}).success(function(a){var d=c.parseResponseParameters(a);d.hasOwnProperty("oauth_token")===!1&&g.reject("Oauth request token was not received");var h=c.generateOauthParametersInstance(e);h.oauth_token=d.oauth_token;var i=d.oauth_token_secret,j="https://oauth.withings.com/account/authorize",k=c.createSignature("GET",j,{},h,f);h.oauth_signature=k.signature;var l=c.generateUrlParameters(h),m=window.open(j+"?"+l,"_blank","location=no,clearsessioncache=yes,clearcache=yes");m.addEventListener("loadstart",function(a){if(0===a.url.indexOf("http://localhost/callback")){var h=a.url.split("?")[1];d=c.parseResponseParameters(h),d.hasOwnProperty("oauth_verifier")===!1&&g.reject("Browser authentication failed to complete.  No oauth_verifier was returned");var j=c.generateOauthParametersInstance(e);j.oauth_token=d.oauth_token;var k="https://oauth.withings.com/account/access_token",l=c.createSignature("GET",k,{},j,f,i);j.oauth_signature=l.signature;var n=c.generateUrlParameters(j);b({method:"get",url:k+"?"+n}).success(function(a){var b=c.parseResponseParameters(a);b.hasOwnProperty("oauth_token_secret")===!1&&g.reject("Oauth access token was not received"),g.resolve(b)}).error(function(a){g.reject(a)})["finally"](function(){setTimeout(function(){m.close()},10)})}})}).error(function(a){g.reject(a)})}else g.reject("Missing jsSHA JavaScript library")})}catch(h){g.reject(h)}return g.promise},foursquare:function(b,c){var e=a.defer();try{d(e,function(){var a="http://localhost/callback";void 0!==c&&c.hasOwnProperty("redirect_uri")&&(a=c.redirect_uri);var d=window.open("https://foursquare.com/oauth2/authenticate?client_id="+b+"&redirect_uri="+a+"&response_type=token","_blank","location=no,clearsessioncache=yes,clearcache=yes");d.addEventListener("loadstart",function(b){if(0===b.url.indexOf(a)){d.removeEventListener("exit",function(a){}),d.close();for(var c=b.url.split("#")[1],f=c.split("&"),g=[],h=0;h<f.length;h++)g[f[h].split("=")[0]]=f[h].split("=")[1];if(void 0!==g.access_token&&null!==g.access_token){var i={access_token:g.access_token,expires_in:g.expires_in};e.resolve(i)}else e.reject("Problem authenticating")}})})}catch(f){e.reject(f)}return e.promise},magento:function(e,f,g){var h=a.defer();try{d(h,function(){if("undefined"!=typeof jsSHA){var a={oauth_callback:"http://localhost/callback",oauth_consumer_key:f,oauth_nonce:c.createNonce(5),oauth_signature_method:"HMAC-SHA1",oauth_timestamp:Math.round((new Date).getTime()/1e3),oauth_version:"1.0"},d=c.createSignature("POST",e+"/oauth/initiate",a,{oauth_callback:"http://localhost/callback"},g);b.defaults.headers.post.Authorization=d.authorization_header,b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b({method:"post",url:e+"/oauth/initiate",data:"oauth_callback=http://localhost/callback"}).success(function(d){for(var f=d.split("&"),i={},j=0;j<f.length;j++)i[f[j].split("=")[0]]=f[j].split("=")[1];i.hasOwnProperty("oauth_token")===!1&&h.reject("Oauth request token was not received");var k=i.oauth_token_secret,l=window.open(e+"/oauth/authorize?oauth_token="+i.oauth_token,"_blank","location=no,clearsessioncache=yes,clearcache=yes");l.addEventListener("loadstart",function(d){if(0===d.url.indexOf("http://localhost/callback")){for(var f=d.url.split("?")[1],i=f.split("&"),j={},m=0;m<i.length;m++)j[i[m].split("=")[0]]=i[m].split("=")[1];j.hasOwnProperty("oauth_verifier")===!1&&h.reject("Browser authentication failed to complete.  No oauth_verifier was returned"),delete a.oauth_signature,delete a.oauth_callback,a.oauth_token=j.oauth_token,a.oauth_nonce=c.createNonce(5),a.oauth_verifier=j.oauth_verifier;var n=c.createSignature("POST",e+"/oauth/token",a,{},g,k);b.defaults.headers.post.Authorization=n.authorization_header,b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b({method:"post",url:e+"/oauth/token"}).success(function(a){for(var b=a.split("&"),c={},d=0;d<b.length;d++)c[b[d].split("=")[0]]=b[d].split("=")[1];c.hasOwnProperty("oauth_token_secret")===!1&&h.reject("Oauth access token was not received"),h.resolve(c)}).error(function(a){h.reject(a)})["finally"](function(){setTimeout(function(){l.close()},10)})}})}).error(function(a){h.reject(a)})}else h.reject("Missing jsSHA JavaScript library")})}catch(i){h.reject(i)}return h.promise},vkontakte:function(b,c){var e=a.defer();try{d(e,function(){var a=window.open("https://oauth.vk.com/authorize?client_id="+b+"&redirect_uri=http://oauth.vk.com/blank.html&response_type=token&scope="+c.join(",")+"&display=touch&response_type=token","_blank","location=no,clearsessioncache=yes,clearcache=yes");a.addEventListener("loadstart",function(b){var c=b.url.split("#");if("https://oauth.vk.com/blank.html"==c[0]||"http://oauth.vk.com/blank.html"==c[0]){a.removeEventListener("exit",function(a){}),a.close();for(var d=b.url.split("#")[1],f=d.split("&"),g=[],h=0;h<f.length;h++)g[f[h].split("=")[0]]=f[h].split("=")[1];if(void 0!==g.access_token&&null!==g.access_token){var i={access_token:g.access_token,expires_in:g.expires_in};void 0!==g.email&&null!==g.email&&(i.email=g.email),e.resolve(i)}else e.reject("Problem authenticating")}})})}catch(f){e.reject(f)}return e.promise},odnoklassniki:function(b,c){var e=a.defer();try{d(e,function(){var a=window.open("http://www.odnoklassniki.ru/oauth/authorize?client_id="+b+"&scope="+c.join(",")+"&response_type=token&redirect_uri=http://localhost/callback&layout=m","_blank","location=no,clearsessioncache=yes,clearcache=yes");a.addEventListener("loadstart",function(b){if(0===b.url.indexOf("http://localhost/callback")){for(var c=b.url.split("#")[1],d=c.split("&"),f=[],g=0;g<d.length;g++)f[d[g].split("=")[0]]=d[g].split("=")[1];void 0!==f.access_token&&null!==f.access_token?e.resolve({access_token:f.access_token,session_secret_key:f.session_secret_key}):e.reject("Problem authenticating"),setTimeout(function(){a.close()},10)}})})}catch(f){e.reject(f)}return e.promise},imgur:function(b,c){var e=a.defer();try{d(e,function(){var a="http://localhost/callback";void 0!==c&&c.hasOwnProperty("redirect_uri")&&(a=c.redirect_uri);var d=window.open("https://api.imgur.com/oauth2/authorize?client_id="+b+"&response_type=token","_blank","location=no,clearsessioncache=yes,clearcache=yes");d.addEventListener("loadstart",function(b){if(0===b.url.indexOf(a)){d.removeEventListener("exit",function(a){}),d.close();for(var c=b.url.split("#")[1],f=c.split("&"),g=[],h=0;h<f.length;h++)g[f[h].split("=")[0]]=f[h].split("=")[1];void 0!==g.access_token&&null!==g.access_token?e.resolve({access_token:g.access_token,expires_in:g.expires_in,account_username:g.account_username}):e.reject("Problem authenticating")}})})}catch(f){e.reject(f)}return e.promise},spotify:function(b,c,e){var f=a.defer();try{d(f,function(){var a="http://localhost/callback";void 0!==e&&e.hasOwnProperty("redirect_uri")&&(a=e.redirect_uri);var d=window.open("https://accounts.spotify.com/authorize?client_id="+b+"&redirect_uri="+a+"&response_type=token&scope="+c.join(" "),"_blank","location=no,clearsessioncache=yes,clearcache=yes");d.addEventListener("loadstart",function(b){if(0===b.url.indexOf(a)){d.removeEventListener("exit",function(a){}),d.close();for(var c=b.url.split("#")[1],e=c.split("&"),g=[],h=0;h<e.length;h++)g[e[h].split("=")[0]]=e[h].split("=")[1];void 0!==g.access_token&&null!==g.access_token?f.resolve({access_token:g.access_token,expires_in:g.expires_in,account_username:g.account_username}):f.reject("Problem authenticating")}})})}catch(g){f.reject(g)}return f.promise},uber:function(b,c,e){var f=a.defer();try{d(f,function(){var a="http://localhost/callback";void 0!==e&&e.hasOwnProperty("redirect_uri")&&(a=e.redirect_uri);var d=window.open("https://login.uber.com/oauth/authorize?client_id="+b+"&redirect_uri="+a+"&response_type=token&scope="+c.join(" "),"_blank","location=no,clearsessioncache=yes,clearcache=yes");d.addEventListener("loadstart",function(b){if(0===b.url.indexOf(a)){d.removeEventListener("exit",function(a){}),d.close();for(var c=b.url.split("#")[1],e=c.split("&"),g=[],h=0;h<e.length;h++)g[e[h].split("=")[0]]=e[h].split("=")[1];void 0!==g.access_token&&null!==g.access_token?f.resolve({access_token:g.access_token,token_type:g.token_type,expires_in:g.expires_in,scope:g.scope}):f.reject("Problem authenticating")}})})}catch(g){f.reject(g)}return f.promise},windowsLive:function(b,c,e){var f=a.defer();try{d(f,function(){var a="https://login.live.com/oauth20_desktop.srf";void 0!==e&&e.hasOwnProperty("redirect_uri")&&(a=e.redirect_uri);var d=window.open("https://login.live.com/oauth20_authorize.srf?client_id="+b+"&scope="+c.join(",")+"&response_type=token&display=touch&redirect_uri="+a,"_blank","location=no,clearsessioncache=yes,clearcache=yes");d.addEventListener("loadstart",function(b){if(0===b.url.indexOf(a)){d.removeEventListener("exit",function(a){}),d.close();for(var c=b.url.split("#")[1],e=c.split("&"),g=[],h=0;h<e.length;h++)g[e[h].split("=")[0]]=e[h].split("=")[1];void 0!==g.access_token&&null!==g.access_token?f.resolve({access_token:g.access_token,expires_in:g.expires_in}):f.reject("Problem authenticating")}})})}catch(g){f.reject(g)}return f.promise},yammer:function(b,c){var e=a.defer();try{d(e,function(){var a="http://localhost/callback";void 0!==c&&c.hasOwnProperty("redirect_uri")&&(a=c.redirect_uri);var d=window.open("https://www.yammer.com/dialog/oauth?client_id="+b+"&redirect_uri="+a+"&response_type=token","_blank","location=no,clearsessioncache=yes,clearcache=yes");d.addEventListener("loadstart",function(b){if(0===b.url.indexOf(a)){d.removeEventListener("exit",function(a){}),d.close();for(var c=b.url.split("#")[1],f=c.split("&"),g=[],h=0;h<f.length;h++)g[f[h].split("=")[0]]=f[h].split("=")[1];void 0!==g.access_token&&null!==g.access_token?e.resolve({access_token:g.access_token}):e.reject("Problem authenticating")}})})}catch(f){e.reject(f)}return e.promise},venmo:function(b,c,e){var f=a.defer();try{d(f,function(){var a="http://localhost/callback";void 0!==e&&e.hasOwnProperty("redirect_uri")&&(a=e.redirect_uri);var d=window.open("https://api.venmo.com/v1/oauth/authorize?client_id="+b+"&redirect_uri="+a+"&response_type=token&scope="+c.join(" "),"_blank","location=no,clearsessioncache=yes,clearcache=yes");d.addEventListener("loadstart",function(b){if(0===b.url.indexOf(a)){d.removeEventListener("exit",function(a){}),d.close();for(var c=b.url.split("#")[1],e=c.split("&"),g=[],h=0;h<e.length;h++)g[e[h].split("=")[0]]=e[h].split("=")[1];void 0!==g.access_token&&null!==g.access_token?f.resolve({access_token:g.access_token,expires_in:g.expires_in}):f.reject("Problem authenticating")}})})}catch(g){f.reject(g)}return f.promise},stripe:function(c,e,f,g){var h=a.defer();try{d(h,function(){var a="http://localhost/callback";void 0!==g&&g.hasOwnProperty("redirect_uri")&&(a=g.redirect_uri);var d=window.open("https://connect.stripe.com/oauth/authorize?client_id="+c+"&redirect_uri="+a+"&scope="+f+"&response_type=code","_blank","location=no,clearsessioncache=yes,clearcache=yes");d.addEventListener("loadstart",function(f){0===f.url.indexOf("http://localhost/callback")&&(requestToken=f.url.split("code=")[1],b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b({method:"post",url:"https://connect.stripe.com/oauth/token",data:"client_id="+c+"&client_secret="+e+"&redirect_uri="+a+"&grant_type=authorization_code&code="+requestToken}).success(function(a){h.resolve(a)}).error(function(a,b){h.reject("Problem authenticating")})["finally"](function(){setTimeout(function(){d.close()},10)}))})})}catch(i){h.reject(i)}return h.promise},rally:function(c,e,f,g){var h=a.defer();try{d(h,function(){var a="http://localhost/callback";void 0!==g&&g.hasOwnProperty("redirect_uri")&&(a=g.redirect_uri);var d=window.open("https://rally1.rallydev.com/login/oauth2/auth?client_id="+c+"&redirect_uri="+a+"&scope="+f+"&response_type=code","_blank","location=no,clearsessioncache=yes,clearcache=yes");d.addEventListener("loadstart",function(f){0===f.url.indexOf("http://localhost/callback")&&(requestToken=f.url.split("code=")[1],b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b({method:"post",url:"https://rally1.rallydev.com/login/oauth2/auth",data:"client_id="+c+"&client_secret="+e+"&redirect_uri="+a+"&grant_type=authorization_code&code="+requestToken}).success(function(a){h.resolve(a)}).error(function(a,b){h.reject("Problem authenticating")})["finally"](function(){setTimeout(function(){d.close()},10)}))})})}catch(i){h.reject(i)}return h.promise},familySearch:function(c,e,f){var g=a.defer();try{d(g,function(){var a="http://localhost/callback";void 0!==f&&f.hasOwnProperty("redirect_uri")&&(a=f.redirect_uri);var d=window.open("https://ident.familysearch.org/cis-web/oauth2/v3/authorization?client_id="+c+"&redirect_uri="+a+"&response_type=code&state="+e,"_blank","location=no,clearsessioncache=yes,clearcache=yes");d.addEventListener("loadstart",function(e){if(0===e.url.indexOf(a)){var f=e.url.split("code=")[1];b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b({method:"post",url:"https://ident.familysearch.org/cis-web/oauth2/v3/token",data:"client_id="+c+"&redirect_uri="+a+"&grant_type=authorization_code&code="+f}).success(function(a){g.resolve(a)}).error(function(a,b){g.reject("Problem authenticating")})["finally"](function(){setTimeout(function(){d.close()},10)})}})})}catch(h){g.reject(h)}return g.promise},envato:function(b,c){var e=a.defer();try{d(e,function(){var a="http://localhost/callback";void 0!==c&&c.hasOwnProperty("redirect_uri")&&(a=c.redirect_uri);var d=window.open("https://api.envato.com/authorization?client_id="+b+"&redirect_uri="+a+"&response_type=token","_blank","location=no,clearsessioncache=yes,clearcache=yes");d.addEventListener("loadstart",function(b){if(0===b.url.indexOf(a)){d.removeEventListener("exit",function(a){}),d.close();for(var c=b.url.split("#")[1],f=c.split("&"),g=[],h=0;h<f.length;h++)g[f[h].split("=")[0]]=f[h].split("=")[1];void 0!==g.access_token&&null!==g.access_token?e.resolve({access_token:g.access_token,expires_in:g.expires_in}):e.reject("Problem authenticating")}})})}catch(f){e.reject(f)}return e.promise},weibo:function(d,e,f,g){var h=a.defer();if(window.cordova){var i=cordova.require("cordova/plugin_list").metadata;if(c.isInAppBrowserInstalled(i)===!0){var j="http://localhost/callback";void 0!==g&&g.hasOwnProperty("redirect_uri")&&(j=g.redirect_uri);var k="https://open.weibo.cn/oauth2/authorize?display=mobile&client_id="+d+"&redirect_uri="+j+"&scope="+f.join(",");void 0!==g&&(g.hasOwnProperty("language")&&(k+="&language="+g.language),g.hasOwnProperty("forcelogin")&&(k+="&forcelogin="+g.forcelogin));var l=window.open(k,"_blank","location=no,clearsessioncache=yes,clearcache=yes");l.addEventListener("loadstart",function(a){0===a.url.indexOf(j)&&(requestToken=a.url.split("code=")[1],b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b({method:"post",url:"https://api.weibo.com/oauth2/access_token",data:"client_id="+d+"&client_secret="+e+"&grant_type=authorization_code&code="+requestToken+"&redirect_uri="+j}).success(function(a){h.resolve(a)}).error(function(a,b){h.reject("Problem authenticating")})["finally"](function(){setTimeout(function(){l.close()},10)}))}),l.addEventListener("exit",function(a){h.reject("The sign in flow was canceled")})}else h.reject("Could not find InAppBrowser plugin")}else h.reject("Cannot authenticate via a web browser");return h.promise},jawbone:function(d,e,f,g){var h=a.defer();if(window.cordova){var i=cordova.require("cordova/plugin_list").metadata;if(c.isInAppBrowserInstalled(i)===!0){var j="http://localhost/callback";void 0!==g&&g.hasOwnProperty("redirect_uri")&&(j=g.redirect_uri);var k=window.open("https://jawbone.com/auth/oauth2/auth?client_id="+d+"&redirect_uri="+j+"&response_type=code&scope="+f.join(" "),"_blank","location=no,clearsessioncache=yes,clearcache=yes");k.addEventListener("loadstart",function(a){if(0===a.url.indexOf(j)){var c=a.url.split("code=")[1];b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b({method:"post",url:"https://jawbone.com/auth/oauth2/token",
data:"client_id="+d+"&client_secret="+e+"&grant_type=authorization_code&code="+c}).success(function(a){h.resolve(a)}).error(function(a,b){h.reject("Problem authenticating")})["finally"](function(){setTimeout(function(){k.close()},10)})}}),k.addEventListener("exit",function(a){h.reject("The sign in flow was canceled")})}else h.reject("Could not find InAppBrowser plugin")}else h.reject("Cannot authenticate via a web browser");return h.promise},untappd:function(b,d){var e=a.defer();if(window.cordova){var f=cordova.require("cordova/plugin_list").metadata;if(c.isInAppBrowserInstalled(f)===!0){var g="http://localhost/callback";void 0!==d&&d.hasOwnProperty("redirect_url")&&(g=d.redirect_url);var h=window.open("https://untappd.com/oauth/authenticate/?client_id="+b+"&redirect_url="+g+"&response_type=token","_blank","location=no,clearsessioncache=yes,clearcache=yes");h.addEventListener("loadstart",function(a){if(0===a.url.indexOf(g)){h.removeEventListener("exit",function(a){}),h.close();for(var b=a.url.split("#")[1],c=b.split("&"),d=[],f=0;f<c.length;f++)d[c[f].split("=")[0]]=c[f].split("=")[1];if(void 0!==d.access_token&&null!==d.access_token){var i={access_token:d.access_token};e.resolve(i)}else e.reject("Problem authenticating")}}),h.addEventListener("exit",function(a){e.reject("The sign in flow was canceled")})}else e.reject("Could not find InAppBrowser plugin")}else e.reject("Cannot authenticate via a web browser");return e.promise},dribble:function(d,e,f,g,h){var i=a.defer();if(window.cordova){var j=cordova.require("cordova/plugin_list").metadata;if(c.isInAppBrowserInstalled(j)===!0){var k="http://localhost/callback",l="https://dribbble.com/oauth/authorize",m="https://dribbble.com/oauth/token";void 0!==g&&g.hasOwnProperty("redirect_uri")&&(k=g.redirect_uri),void 0===h&&(h=c.createNonce(5));var n=f.join(",").replace(/,/g,"+"),o=window.open(l+"?client_id="+d+"&redirect_uri="+k+"&scope="+n+"&state="+h,"_blank","location=no,clearsessioncache=yes,clearcache=yes");o.addEventListener("loadstart",function(a){if(0===a.url.indexOf(k)){var c=a.url.split("code=")[1],f=c.split("&")[0];b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b({method:"post",url:m,data:"client_id="+d+"&redirect_uri="+k+"&client_secret="+e+"&code="+f}).success(function(a){i.resolve(a)}).error(function(a,b){i.reject("Problem authenticating ")})["finally"](function(){setTimeout(function(){o.close()},10)})}}),o.addEventListener("exit",function(a){i.reject("The sign in flow was canceled")})}else i.reject("Could not find InAppBrowser plugin")}else i.reject("Cannot authenticate via a web browser");return i.promise}}}]),angular.module("ngCordovaOauth",["oauth.providers","oauth.utils"]),angular.module("oauth.utils",[]).factory("$cordovaOauthUtility",["$q",function(a){return{isInAppBrowserInstalled:function(a){var b=["cordova-plugin-inappbrowser","org.apache.cordova.inappbrowser"];return b.some(function(b){return a.hasOwnProperty(b)})},createSignature:function(a,b,c,d,e,f){if("undefined"!=typeof jsSHA){for(var g=angular.copy(c),h=Object.keys(d),i=0;i<h.length;i++)g[h[i]]=encodeURIComponent(d[h[i]]);var j=a+"&"+encodeURIComponent(b)+"&",k=Object.keys(g).sort();for(i=0;i<k.length;i++)j+=i==k.length-1?encodeURIComponent(k[i]+"="+g[k[i]]):encodeURIComponent(k[i]+"="+g[k[i]]+"&");var l=new jsSHA(j,"TEXT"),m="";f&&(m=encodeURIComponent(f)),c.oauth_signature=encodeURIComponent(l.getHMAC(encodeURIComponent(e)+"&"+m,"TEXT","SHA-1","B64"));var n=Object.keys(c),o="OAuth ";for(i=0;i<n.length;i++)o+=i==n.length-1?n[i]+'="'+c[n[i]]+'"':n[i]+'="'+c[n[i]]+'",';return{signature_base_string:j,authorization_header:o,signature:c.oauth_signature}}return"Missing jsSHA JavaScript library"},createNonce:function(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;a>d;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b},generateUrlParameters:function(a){var b=Object.keys(a);b.sort();for(var c="",d="",e=0;e<b.length;e++)c+=d+b[e]+"="+a[b[e]],d="&";return c},parseResponseParameters:function(a){if(a.split){for(var b=a.split("&"),c={},d=0;d<b.length;d++)c[b[d].split("=")[0]]=b[d].split("=")[1];return c}return{}},generateOauthParametersInstance:function(a){var b=new jsSHA(Math.round((new Date).getTime()/1e3),"TEXT"),c={oauth_consumer_key:a,oauth_nonce:b.getHash("SHA-1","HEX"),oauth_signature_method:"HMAC-SHA1",oauth_timestamp:Math.round((new Date).getTime()/1e3),oauth_version:"1.0"};return c}}}]);